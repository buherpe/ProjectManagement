@inherits EditComponent<Project, ProjectFactory, ProjectView, MyContext>
@page "/projects/{id:int}"
@using Microsoft.EntityFrameworkCore
@using ProjectManagement.Pages.ProjectStatuses
@using ProjectManagement.Pages.Projects
@using ProjectManagement.Pages.Tasks

@inject NavigationManager NavigationManager

<h3>@View.GetName(): @Entity</h3>

<p>
    <button @onclick="Save" type="button" class="btn btn-primary">Сохранить</button>
</p>

@if (Loading)
{
    <div>Загрузка...</div>
}
else
{
    <EditForm Model="@Entity" OnValidSubmit="@HandleValidSubmit">

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">Наименование</span>
            </div>
            <InputText id="Name" @bind-Value="Entity.Name" class="form-control" />
        </div>

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">Ссылка</span>
            </div>
            <InputText id="Link" @bind-Value="Entity.Link" class="form-control" />
        </div>

        <div class="input-group mb-3">
            <div class="input-group-prepend"><span class="input-group-text">Статус</span></div>
            <LookupComponent TEntity="ProjectStatus" @bind-Entity="@(Entity.Status)" View="@(new ProjectStatusAllView())" />
        </div>

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">Описание</span>
            </div>
            <InputTextArea id="Description" @bind-Value="Entity.Description" class="form-control" />
        </div>

    </EditForm>

    @if (Entity.Id != 0)
    {
        <DataGridComponent View=@(new TasksByProjectView(Entity.Id)) CreateButtonVisible="false" />
    }
}

@code {
    public void HandleValidSubmit()
    {

    }

    public override IQueryable<Project> Include(DbSet<Project> dbSet)
    {
        return dbSet.Include(x => x.Status);
    }
}
